<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mini HKBus Map</title>
  <link rel="stylesheet" href="/src/style.css" />
</head>

<body>
  <noscript> You need to enable JavaScript to run this app. </noscript>
  <!-- Map container -->
  <div id="map"></div>

  <!-- Custom Controls -->
  <button id="bus-button" class="control-button" data-i18n-title="tooltips.bus_stops">
    ğŸš
  </button>
  <button id="pin-button" class="control-button">
    ğŸ“
  </button>
  <button id="settings-button" class="control-button" data-i18n-title="tooltips.settings">
    âš™ï¸
  </button>

  <div id="more-wrapper" class="dropdown-wrapper">
    <button id="more-button" class="control-button" data-i18n-title="tooltips.more_options">
      â‹®
    </button>
    <div id="more-menu" class="dropdown-menu">
      <!-- menu items will be inserted here -->
    </div>
  </div>

  <!-- Search Bar -->
  <div id="search-bar-container" class="hidden">
    <!-- Form input to auto-save history -->
    <form id="search-form" onsubmit="return false;">
      <div id="search-bar">
        <input type="search" id="search-input" name="landmark location" placeholder="" autocomplete="on" />
        <button id="search-button" type="submit" data-i18n-title="tooltips.search_location">
          ğŸ”
        </button>
      </div>
    </form>
  </div>

  <div id="info-sidebar" class="hidden">
    <div id="info-header">
      <div id="info-title-content"></div>
      <button id="info-close-button" data-i18n-title="tooltips.close_sidebar">
        &times;
      </button>
    </div>
    <div id="info-content"></div>
  </div>

  <!-- Loading Indicator -->
  <div id="loading">
    <div class="loading-spinner"></div>
    <div class="loading-text">ğŸŒ Loading mapâ€¦</div>
  </div>

  <!-- Error Message -->
  <div id="error-message" class="hidden">âš ï¸ Error</div>

  <!-- Settings Dialog -->
  <div id="settings-dialog" class="settings-overlay hidden">
    <div class="settings-content">
      <div class="settings-bar">
        <div class="settings-bar-section">
          <button id="add-setting-btn" class="icon-btn" data-i18n-title="tooltips.add_setting">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
          </button>
        </div>
        <div class="settings-bar-section center">
          <h2 id="settings-title" data-i18n-text="SettingDialog.settings_title"></h2>
          <div id="status-message" class="transitional-message" role="status" aria-label="Saved" aria-live="polite">
            <svg viewBox="0 0 24 24" width="28" height="28" aria-hidden="true" style="
                  display: block;
                  stroke: #28a745;
                  stroke-width: 2.5;
                  stroke-linecap: round;
                  stroke-linejoin: round;
                  fill: none;
                ">
              <circle cx="12" cy="12" r="10" />
              <path d="M7 12l3 3 7-7" />
            </svg>
          </div>
        </div>
        <div class="settings-bar-section right">
          <button id="close-btn" class="icon-btn" data-i18n-title="tooltips.close_settings">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>
      <div class="table-scrollable">
        <table id="settings-table">
          <tbody>
            <!-- Rows will be dynamically inserted here -->
          </tbody>
        </table>
      </div>
      <div style="margin-top: 10px;">
        <button id="locale-button" class="icon-btn hidden" data-i18n-title="tooltips.my_locale" style="font-size: 1.25rem;">
          ğŸŒ
        </button>
      </div>
    </div>
  </div>
  
  <script>
    window.APP_CONFIG = {
      jsonConfig_url: '/config.json',
    };
  </script>

  <!-- Main application script - loads Google Maps API dynamically -->
  <script type="module" src="/src/app.js"></script>

  <!-- Frontend Test Runner (loads after main application) -->
  <script type="module">
    // loads dev-specific code (excluded from production bundle)
    if (!import.meta.env || import.meta.env.DEV) {
      import('/src/test_runner.js')
        .then(() => { })
        .catch((error) => {
          console.error('Failed to load test runner:', error);
        });
    }
  </script>
</body>

</html>